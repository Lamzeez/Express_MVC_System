- Quick idea of how this project works
  - This is an Express app organized using MVC (Model-View-Controller)
  - Browser requests go to routes
  - Routes call controller functions
  - Controllers validate input, decide what to do, then call models
  - Models talk to the MySQL database (users, notes, sessions)
  - Controllers render views (EJS templates) or redirect to another route
  - Middleware (auth/guest) runs before controllers to protect pages based on login state
  - Sessions keep users logged in by storing a session id in a cookie and session data in the database

- Root folder (project-level files)
  - node_modules/
    - Installed packages (generated by npm)
    - Do not edit manually
    - Do not upload to GitHub (keep it in .gitignore)
  - package.json
    - Project metadata and dependency list
    - Contains scripts like npm run dev and npm start
  - package-lock.json
    - Locks exact dependency versions so installs are consistent
  - server.js
    - App entry point
    - Creates the Express app, registers middleware, sets up sessions, mounts routes, starts the server
  - .env
    - Environment variables for local setup (DB credentials and session secret)
    - Do not commit this file publicly
  - database.sql
    - SQL you import into MySQL/phpMyAdmin to create the database and tables
    - Typically includes tables for users, notes, and sessions

- src/ folder (application code)
  - This folder holds the MVC parts and related configuration

- src/config/
  - db.js
    - Creates a MySQL connection pool using mysql2/promise
    - All models use this pool for queries
    - Reads DB_HOST, DB_USER, DB_PASS, DB_NAME from .env
  - sessionStore.js
    - Configures a MySQL-backed session store (express-mysql-session)
    - Sessions are persisted in the sessions table in the database
    - This means login sessions survive server restarts (until they expire)

- src/middleware/
  - auth.js
    - Protects routes that require login
    - If req.session.user is missing, it redirects to /auth/login
    - Used on notes routes so only logged-in users can access notes
  - guest.js
    - Protects routes that should be accessible only when logged out
    - If a user is already logged in, it redirects to /notes
    - Used on /auth/login and /auth/register

- src/routes/
  - auth.routes.js
    - Defines URL endpoints for authentication
    - Examples:
      - GET /auth/login -> show login form
      - POST /auth/login -> attempt login
      - GET /auth/register -> show register form
      - POST /auth/register -> attempt register
      - POST /auth/logout -> logout
    - Applies guest middleware to login/register
    - Applies auth middleware to logout (only logged-in users can logout)
  - notes.routes.js
    - Defines URL endpoints for notes CRUD
    - Applies auth middleware to all routes (router.use(auth))
    - Examples:
      - GET /notes -> list notes + create form
      - POST /notes -> create note
      - GET /notes/:id -> view note
      - GET /notes/:id/edit -> edit form
      - PUT /notes/:id -> update note
      - DELETE /notes/:id -> delete note

- src/controllers/
  - What controllers do in this app
    - Receive req and res from Express
    - Validate and normalize input
    - Call model methods (database operations)
    - Decide whether to render a view or redirect
    - Never directly write SQL here (that belongs in models)
  - auth.controller.js
    - loginForm
      - Renders login.ejs
      - Usually passes placeholders like error and previously-entered values
    - registerForm
      - Renders register.ejs
    - login
      - Reads email and password from the form
      - Validates basic format (email format, password length)
      - Looks up the user by email using UserModel
      - Compares password with stored password_hash using bcrypt.compare
      - If valid, sets req.session.user = { id, name, email }
      - Redirects to /notes
    - register
      - Reads name, email, password, confirm_password
      - Validates name length, email format, password length, password match
      - Checks if email already exists (unique email)
      - Hashes password with bcrypt.hash
      - Creates user in DB using UserModel
      - Sets session (auto-login) and redirects to /notes
    - logout
      - Destroys the session (req.session.destroy)
      - Clears the session cookie
      - Redirects to /auth/login
  - notes.controller.js
    - index
      - Gets current user id from req.session.user.id
      - Fetches only that user’s notes using NoteModel.getAllByUser(userId)
      - Renders notes/index.ejs
    - show
      - Fetches a single note by id, but also checks user ownership (note must belong to the logged-in user)
      - Renders notes/show.ejs
    - create
      - Validates content is not empty (and max length)
      - Inserts note with user_id set to logged-in user id
      - Redirects to /notes
    - editForm
      - Loads the note (must belong to the user)
      - Renders notes/edit.ejs
    - update
      - Validates content
      - Updates note only if it belongs to the user (WHERE id = ? AND user_id = ?)
      - Redirects back to the note page
    - remove
      - Deletes note only if it belongs to the user
      - Redirects to /notes

- src/models/
  - What models do in this app
    - Contain database logic only
    - Use prepared statements (placeholders) to prevent SQL injection
    - Return plain JS objects or booleans to controllers
  - user.model.js
    - findByEmail(email)
      - SELECT user by email
      - Used for login and for checking duplicates during register
    - findById(id)
      - SELECT user by id (useful if you want profile pages later)
    - create({ name, email, passwordHash })
      - INSERT a new user record
      - Stores passwordHash in password_hash column
  - note.model.js
    - getAllByUser(userId)
      - SELECT notes filtered by user_id
      - Orders by updated_at DESC (latest edited first)
    - getById(noteId, userId)
      - SELECT one note filtered by id AND user_id
      - Prevents users from opening other users’ notes
    - create(userId, { title, content })
      - INSERT note with user_id
    - update(noteId, userId, { title, content })
      - UPDATE note only if it belongs to that user
    - remove(noteId, userId)
      - DELETE note only if it belongs to that user

- src/views/ (EJS templates)
  - What views do in this app
    - Views are the UI layer (HTML templates)
    - They should not do database work
    - They can display variables passed by controllers (notes, errors, currentUser)
  - src/views/partials/
    - header.ejs
      - Shared top section used on many pages
      - Shows navigation links
      - Uses currentUser to show logout button or login/register links
    - footer.ejs
      - Shared bottom section
  - src/views/auth/
    - login.ejs
      - Login form posting to POST /auth/login
      - Shows error messages if controller passes one
    - register.ejs
      - Register form posting to POST /auth/register
      - Shows error messages if controller passes one
  - src/views/notes/
    - index.ejs
      - The main notes page
      - Usually contains:
        - Create note form (POST /notes)
        - Notes list with open/edit/delete controls
    - show.ejs
      - Displays a single note
    - edit.ejs
      - Shows a form to update a note
      - Submits as PUT using method override

- src/public/
  - styles.css
    - Front-end styling
    - Served as static files by express.static in server.js

- src/data/notes.json
  - This file was used in the earlier file-based version of NoteCore
  - If your current NoteModel uses MySQL, this JSON file is not used anymore
  - It’s safe to remove if you are fully on MySQL and no code references it
  - If you want to keep it, just treat it as leftover from the earlier stage

- The request flow (end-to-end)
  - General request lifecycle
    - Browser requests a URL (example: GET /notes)
    - Express matches the route in routes files
    - Middleware runs (example: auth.js checks if logged in)
    - Controller runs
    - Controller calls model
    - Model queries database and returns results
    - Controller renders a view or redirects
    - View produces HTML response back to the browser
  - Login flow
    - GET /auth/login
      - guest middleware ensures logged-in users are sent to /notes
      - auth.controller.loginForm renders login.ejs
    - POST /auth/login
      - auth.controller.login validates input
      - user.model.findByEmail checks the user
      - bcrypt.compare checks password
      - On success: req.session.user is created
      - Redirect to /notes
  - Register flow
    - GET /auth/register
      - guest middleware applies
      - auth.controller.registerForm renders register.ejs
    - POST /auth/register
      - auth.controller.register validates inputs
      - user.model.findByEmail prevents duplicate email
      - bcrypt.hash creates password_hash
      - user.model.create inserts user
      - req.session.user set (auto login)
      - Redirect to /notes
  - Logout flow
    - POST /auth/logout
      - auth middleware ensures only logged-in user can do this
      - auth.controller.logout destroys the session and clears cookie
      - Redirect to /auth/login
  - Notes CRUD flow (authenticated)
    - GET /notes
      - auth middleware checks session
      - notes.controller.index loads notes for req.session.user.id
      - renders notes/index.ejs
    - POST /notes
      - validates content
      - note.model.create inserts with user_id
      - redirects back to /notes
    - GET /notes/:id
      - note.model.getById(id, userId) ensures ownership
      - renders notes/show.ejs
    - GET /notes/:id/edit
      - loads the note (ownership check)
      - renders notes/edit.ejs
    - PUT /notes/:id
      - method override converts form to PUT
      - validates then updates only if owned by user
      - redirects to /notes/:id
    - DELETE /notes/:id
      - method override converts form to DELETE
      - deletes only if owned by user
      - redirects to /notes

- Sessions in this project (what to know)
  - How sessions work here
    - A cookie (notecore.sid) stores only the session id
    - Session data (like req.session.user) is stored in MySQL sessions table
    - On each request, Express reads the cookie, loads session data from DB, and attaches it to req.session
  - Where session settings are defined
    - In server.js using express-session
    - sessionStore.js provides MySQL session storage
  - Important cookie options
    - httpOnly true helps prevent JavaScript from reading the cookie
    - maxAge controls how long session cookie lasts
    - For production, you would also consider:
      - cookie.secure true (requires HTTPS)
      - sameSite option (lax/strict) to reduce CSRF risk

- MVC concerns and separation of responsibilities (what belongs where)
  - Model
    - Database queries only
    - No rendering
    - No direct access to req/res
  - View
    - HTML templates only (EJS)
    - Display data passed from controllers
    - Minimal logic for formatting (like truncating a preview)
  - Controller
    - Glue code
    - Input validation and flow control
    - Calls models and decides which view to render or where to redirect
  - Routes
    - URL mapping
    - Decides which controller action runs for which route
    - Applies middleware
  - Middleware
    - Cross-cutting checks that happen before controllers
    - Authentication checks are a classic middleware use

- Authentication concerns (important behavior)
  - Passwords
    - Plain passwords are never stored
    - bcrypt creates password_hash in the database
    - bcrypt.compare verifies login
  - Unique email
    - Database has UNIQUE on users.email
    - Controller also checks for existing email for nicer error message
  - Ownership checks for notes
    - Every note query includes user_id = current user id
    - This prevents one user from accessing another user’s notes even if they guess an id
  - Session state
    - req.session.user is the “logged in” flag and identity
    - If this is missing, auth middleware redirects to login

- Method override (why PUT and DELETE work from forms)
  - HTML forms only support GET and POST
  - method-override lets you send POST with a query like ?_method=PUT or ?_method=DELETE
  - Express then treats it as PUT/DELETE so you can build REST-like routes

- Error handling and rendering notes
  - Controllers often pass error strings to views
  - Views show errors when present
  - If a note is missing or not owned by the user, the controller returns 404

- Database tables (what each does)
  - users
    - Stores account info (name, email, password_hash)
  - notes
    - Stores notes for each user (user_id foreign key)
    - ON DELETE CASCADE deletes a user’s notes if the user is deleted
  - sessions
    - Stores session blobs and expiry timestamps for express-session with MySQL store

- Common issues you might face and how to recognize them
  - Cannot connect to MySQL
    - Usually DB_HOST/DB_USER/DB_PASS/DB_NAME are wrong in .env
    - Or MySQL server is not running
  - Sessions not persisting
    - sessions table missing or wrong table name
    - sessionStore.js points to the wrong database
  - Login always fails
    - User not in DB
    - password_hash not stored correctly
    - bcrypt compare failing because hash is not the one you expect
  - Notes not showing
    - user_id mismatch
    - note.model.getAllByUser uses wrong userId

- Practical “next steps” you might add later (optional improvements)
  - Flash messages for success/error (instead of only per-page error variables)
  - CSRF protection for POST/PUT/DELETE forms
  - Rate limiting on login to reduce brute force attempts
  - Input sanitization and stricter validation rules
  - Helmet and secure headers
  - Pagination or search for notes
  - A profile page that reads current user from req.session.user and user.model.findById

- One final mental model to remember
  - routes decide where requests go
  - middleware decides if a request is allowed to continue
  - controllers decide what should happen
  - models do database operations
  - views display data to the user
  - sessions remember who the user is between requests
